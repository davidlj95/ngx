# `@davidlj95/ngx-meta` docs infra

Thanks to [Material for Mkdocs](https://squidfunk.github.io/mkdocs-material/)

## Setup

Project uses [Poetry](https://python-poetry.org/) to manage dependencies. `pnpm` is also used to install an NPM dependency (see below)

To install (both Python and NPM deps), you can run for short:

```
make install
```

### Python dependencies

Poetry will also create an ad-hoc virtual environment to install dependencies there and don't pollute your Python installation.

> I like to create the virtual environment in the project directory, so have [Poetry's `virtualenvs.in-project` configuration enabled](https://python-poetry.org/docs/configuration/#virtualenvsin-project)

### Python version

Checkout the `pyproject.toml` file for required version. In my case, Poetry automatically read the file and grabbed a Python version installed via [homebrew](https://fontsource.org/). So eventually I didn't need any Python version manager.

If needed, I personally like [`pyenv`](https://github.com/pyenv/pyenv) to manage multiple Python versions. Probably any version 3 will work so:

```
pyenv local 3
```

Should get you up and running

### NPM package

In order to use custom fonts, [FontSource](https://fontsource.org/) is used. Which distributes font files from Google Fonts as `npm` packages. `pnpm` is used (as in the rest of packages in this repository) to install the package to fetch the font files.

Those font files are later automagically copied into the docs project by the `make prebuild` command

## Development

Run `make serve` and open http://localhost:8000

> You can run `make serve-public` if you want to expose port 8000 to all your network interfaces. For instance, to see docs in another device in same network by accessing `http://your-machine-local-net-ip:8000`

## Build

Run `make` (or `make build`). Output will be in `site` directory.

## Prebuild

Before building or serving, a `prebuild` task is ran to:

- Copy custom downloaded fonts from `node_modules` into docs site public dir
- Copy most of package's `README.md` as homepage for docs too
- Copy `CHANGELOG.md` so can be accessed in documentation

## CI/CD

Docs are generated in every push to `main` branch

They can also be previewed in a PR (when those are not from forks, for safety). Add the `preview docs` label to your PR. And the next time the CI/CD runs, a preview site will be deployed with those changes.

> [!IMPORTANT]
> Assigning the label is not enough. You must trigger another CI/CD run after that. A re-run is not valid, given it will not take into account the label change.
> A trick I do is to push an empty commit `git commit --allow-empty`
> Take into account this when opening a PR for instance. Given you can't open a PR with a set of labels already assigned, you'll probably need another CI/CD run to trigger the docs preview

## API reference

Is generated by [API Extractor](https://api-extractor.com/). It's not updated automagically when serving to avoid expensive rebuilds.

To generate / update API reference docs, run API Extractor / API Documenter tasks in main `package.json`. WebStorm's API Documenter run config actually runs them both at once. Remember **tsc** is needed to run first as API Extractor / Documenter uses its output to work. WebStorm run config also runs `tsc` before API Extractor / Documenter runs.

> [!CAUTION]
> You can't link to other docs from API reference generated docs. So absolute URLs are used instead

## Notes

### Autolinks

[Mkdocs Autolinks plugin](https://github.com/zachhannum/mkdocs-autolinks-plugin) is used to allow referring to documentation files by name. And therefore avoid directory reorganizations to mess up links.

So prefer to link docs by file name (ie: `get-started.md`) instead of including the path to the document (ie: ~~`../get-started.md`~~)

> [!CAUTION]
> The extension doesn't seem to work in files that are included (includes common links file)

## Quirks

### No `.python-version` file

A `.python-version` file for `pyenv` is not tracked in repository given Renovate bot used to update dependencies doesn't manage the file properly in our scenario.

Specifically, it [processes the file as a `pyenv` version file](https://docs.renovatebot.com/modules/manager/pyenv/). It appears in the dependency dashboard issue as `pyenv`. But it tries to pin to a version and doesn't succeed doing so. I was providing an exact version like `MAJOR.MINOR.PATCH` in the file

Could be interesting to report the issue to Renovate.
